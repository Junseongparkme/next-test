---
slug: how-to-work
title: 동작 원리
tags: [Next.js]
---

## 개발 환경과 프로덕션 환경

환경은 코드가 실행되는 컨텍스트

- 개발 환경 : 로컬 머신으로 애플리케이션을 구축하고 실행
- 프로덕션 환경 : 유저가 애플리케이션을 사용할 수 있도록 배포 준비

### 각 환경에서 Next.js의 동작

- 개발 환경 : TypeScript 및 ESLint의 통합, Fast Refresh 등 다양한 기능을 통해 높은 개발자 경험 제공
- 프로덕션 환경 : 코드의 성능과 접근성을 개선하여 높은 사용자 경험 제공
- 각 환경마다 고려 사항과 목표가 다르므로, 개발 환경에서 프로덕션 환경으로 이동하려면 컴파일링, 번들링, 압축, 코드 스플리팅 등 다양한 작업을 거쳐야함
- Next.js에서는 SWC를 통해 이런 작업들을 처리하여 프로덕션 환경으로 쉽게 전환

## 컴파일링

한 언어로 된 코드를 가져와 다른 언어 또는 해당 언어의 다른 버전으로 출력하는 과정

- 개발자는 높은 개발자 경험을 제공하는 TypeScript, JSX 등 최신 언어로 코드를 작성함
- 이러한 언어는 브라우저가 해석할 수 없기 때문에 자바스크립트로 컴파일되어야 함
- Next.js에서 컴파일은 개발 환경에서 코드를 수정하거나 빌드 시 실행

## 압축

코드의 기능을 유지하면서 불필요한 코드 및 주석을 제거하는 과정

- 개발자는 주석, 공백, 들여쓰기를 사용해 가독성이 좋은 코드를 작성함
- 파일의 크기를 줄여 애플리케이션의 성능을 높이기 위해 사용
- Next.js에서 자바스크립트 및 CSS는 프로덕션 환경에서 자동으로 압축됨

## 번들링

복잡한 종속성을 해결하고, 파일들을 브라우저에 최적화된 번들로 패키징하는 과정

- 개발자는 애플리케이션을 모듈, 컴포넌트, 함수로 나누어 개발하고, 이들이 병합되어 애플리케이션이 구축됨
- 유저가 웹 페이지를 방문할 때 서버로 보내는 요청을 줄이기 위해 사용

## 코드 스플리팅

애플리케이션 번들을 각 진입점에 필요한 더 작은 단위(chunk)로 분할하는 과정

- 개발자는 애플리케이션을 서로 다른 URL을 통해 접근할 수 있는 여러 페이지로 나누어 개발하며, 각 페이지는 애플리케이션의 고유한 진입점이 됨
- 특정 페이지를 실행하는데 필요한 코드만 불러와 애플리케이션의 초기 로드 시간을 개선하는 것이 목적
- Next.js에서 pages 디렉토리 내에 있는 각각의 파일은 빌드시 자바스크립트 번들로 스플리팅 됩니다.
- 페이지 간 공유되는 모든 코드는 별도의 번들로 스플리팅되어 다시 다운로드되지 않음
- 초기 페이지 로드 후 Next.js는 링크로 이동할 수 있는 페이지의 코드를 미리 불러옴

## 빌드 타임과 런타임

### 빌드 타임

프로덕션용 코드를 준비하는 단계

- 애플리케이션 빌드시 Next.js는 코드를 프로덕션 최적화 파일로 변환하여 배포할 수 있게 만들어 줌
- 프로덕션에 최적화된 파일이란 아래 파일을 의미함
  - 정적 페이지를 나타내는 HTML
  - 서버에서 페이지를 렌더링하기 위한 자바스크립트
  - 클라이언트에서 페이지에 상호작용을 추가하기 위한 자바스크립트
  - CSS

### 런타임

애플리케이션의 빌드 및 배포 후, 유저의 요청에 의해 애플리케이션이 실행되는 시간

## 클라이언트와 서버

### 클라이언트

웹 애플리케이션의 관점에서 보면, 유저의 기기에서 서버로 요청을 보내는 브라우저를 의미

### 서버

아래 역할을 수행하는 데이터센터의 컴퓨터

- 애플리케이션 코드의 저장
- 클라이언트의 요청 수신
- 연산 수행
- 응답 전송

## 렌더링

리액트에서 작성한 코드를 HTML 형태의 UI로 변환하는 과정

- 서버 또는 클라이언트에서 수행될 수 있으며, 빌드 전이나 런타임 환경에서 매 요청마다 실행 될 수 있음
- Next.js에서는 세 가지 유형의 렌더링을 사용할 수 있음
  - Server Side Rendering
  - Static Site Generation
  - Client Side Rendering

### Pre Rendering

- Static Site Generation과 Server Side Rendering을 의미
- 클라이언트에게 응답이 전송되기 전에 외부 데이터를 페칭하고 서버에서 컴포넌트를 HTML로 변환
- Next.js에서 모든 페이지의 기본 렌더링 방식

### Static Site Generation

- HTML이 서버에서 생성되지만, 런타임 환경에서는 서버가 존재하지 않음
- 빌드 시 컨텐츠가 생성, 배포 시 HTML은 CDN에 저장되어 각 요청에 대해 재사용

#### Incremental Static Regeneration

- 빌드 후 정적 페이지를 생성하거나 업데이트 하기 위해 사용
- 데이터가 변경되어도 사이트 전체를 다시 빌드하지 않는 장점

### Server Side Rendering

- 각각의 요청에 따라 서버에서 HTML 생성
- HTML이 생성된 이후 아래 파일들이 클라이언트로 전송됨
  - 생성된 HTML과 JSON 파일
  - 페이지를 인터렉티브하게 만들기 위한 자바스크립트

#### Hydration

- 클라이언트에서 HTML은 인터렉티브하지 않은 페이지를 보여주기 위해 사용
- 리액트는 JSON과 자바스크립트를 이용해 페이지를 인터렉티브하게 만들어주는데 이 과정이 Hydration

#### Server Component

- 리액트 18버전 및 Next.js 12 버전에서 사용 가능
- 서버에서 완전히 렌더링되며, 일부 로직을 서버에 두고, 그 결과를 클라이언트에 전달
- 클라이언트로 전송되는 번들의 크기가 감소하여 Client Side Rendering의 성능이 개선

### Client Side Rendering

- Next.js를 사용하지 않는 리액트 애플리케이션에서 브라우저는 빈 HTML과 UI를 구성하는 방법을 나타낸 자바스크립트를 전달받음
- 전달받은 파일을 이용해 유저의 장치에서 렌더링이 일어나는 데, 이 과정이 Client Side Rendering
- 완전히 Client Side Rendering으로만 애플리케이션을 구성하면 렌더링되는 동안 유저는 빈 페이지를 보게 됨
- Next.js에서는 useEffect 혹은 SWR 등의 라이브러리를 사용해 구현

## 네트워크

리소스를 공유할 수 있는 서버 컴퓨터들의 연결

- 애플리케이션 코드가 저장되고, 배포된 이후 실행되는 위치를 설정하기 위해 알아두면 좋습니다.
- Next.js 애플리케이션의 코드는 아래 위치에 저장
  - Origin Servers
  - Content Delivery Networks (CDNs)
  - the Edge

### Origin Servers

애플리케이션의 원본 코드를 저장하고 실행하는 메인 컴퓨터

- 코드가 저장될 수 있는 다른 서버 (CDN Servers, Edge Servers)와 구분하기 위해 Origin Server라고 부름
- 요청을 받으면 응답을 보내기 전에 계산을 수행하며, 이 결과를 CDN으로 전송

### CDN

- 전 세계 여러 곳에 HTML이나 이미지와 같은 정적 컨텐츠 저장
- 클라이언트와 Origin Servers 사이에 위치
- 새 요청을 받으면 유저와 가장 가까이에 있는 CDN이 캐싱된 결과를 클라이언트에게 전달
- 각 요청에 대해 계산을 할 필요가 없어 Origin Servers의 부하 감소
- 유저와 가까운 곳에서 응답을 전송하기 때문에 속도가 빠름

### The Edge

사용자와 가장 가까운 네트워크

- CDN은 사용자와 가장 가까운 곳에 정적 파일을 저장하기 때문에 The Edge의 일부로 간주됨
- CDN과 마찬가지로 Edge Servers는 전 세계 여러 위치에 배포됨
- CDN과는 달리 Edge Servers는 코드를 바로 실행할 수 있음 - 캐싱 및 실행 모두 가능
- Edge에서 코드를 실행하면 클라이언트나 서버에서 실행되던 작업을 Edge로 이관하여 아래 장점을 가짐
  - 클라이언트로 전송되는 코드의 양 감소
  - 사용자 요청 일부가 Origin Server로 갈 필요가 없어짐
  - 위 이유들로 인해 애플리케이션 성능이 향상되어 대기 시간 감소
